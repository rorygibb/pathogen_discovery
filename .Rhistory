dplyr::filter(Domestic == "Wild") %>%
dplyr::group_by(HostSpecies) %>%
dplyr::summarise(VRich = sum(Discovered),
HostOrder = head(HostOrder, 1)) %>%
dplyr::group_by(HostOrder) %>%
dplyr::summarise(VRich_Mean = mean(VRich),
VRich_Median = median(VRich),
VRich_SEM = plotrix::std.error(VRich)) %>%
dplyr::arrange(desc(VRich_Mean)) %>%
dplyr::mutate(Year = year)
return(resx)
}
ord_over_time = do.call(rbind.data.frame, lapply(seq(1960, 2015, by=5), getOrderVRich))
oot = reshape2::dcast(ord_over_time[ , c("HostOrder", "Year", "VRich_Mean")], HostOrder ~ Year, value.var="VRich_Mean")
# calculate spearman rank correlation between 2015 and all other years (examine temporal decay)
cor_rho = function(x){ return( as.vector(cor.test(oot$`2015`, x, method="spearman")$estimate) ) }
stab1 = as.data.frame(apply(oot[ , 2:ncol(oot)], 2, cor_rho)) %>%
rename("rho" = 1) %>%
dplyr::mutate(year = seq(1960, 2015, by=5),
model = "Order")
# 2. Family-level comparison of mean viral richness across species
# mean viral richness across species within each order
getFamilyVRich = function(year){
resx = curves %>%
dplyr::filter(Year <= year) %>%
dplyr::filter(HostSpecies != "homo sapiens") %>%
dplyr::filter(Domestic == "Wild") %>%
dplyr::group_by(HostSpecies) %>%
dplyr::summarise(VRich = sum(Discovered),
HostFamily = head(HostFamily, 1),
HostOrder = head(HostOrder, 1)) %>%
dplyr::group_by(HostFamily) %>%
dplyr::summarise(VRich_Mean = mean(VRich),
VRich_Median = median(VRich),
VRich_SEM = plotrix::std.error(VRich),
HostOrder = head(HostOrder, 1)) %>%
dplyr::arrange(desc(VRich_Mean)) %>%
dplyr::mutate(Year = year)
return(resx)
}
fam_over_time = do.call(rbind.data.frame, lapply(seq(1960, 2015, by=5), getFamilyVRich))
fot = reshape2::dcast(fam_over_time[ , c("HostFamily", "Year", "VRich_Mean")], HostFamily ~ Year, value.var="VRich_Mean")
# calculate spearman rank correlation between 2015 and all other years (examine temporal decay)
cor_rho = function(x){ return( as.vector(cor.test(fot$`2015`, x, method="spearman")$estimate) ) }
stab2 = as.data.frame(apply(fot[ , 2:ncol(fot)], 2, cor_rho)) %>%
rename("rho" = 1) %>%
dplyr::mutate(year = seq(1960, 2015, by=5),
model = "Family")
ggplot(rbind(stab1, stab2)) +
geom_line(aes(year, rho, col=model)) +
geom_point(aes(year, rho, col=model))
# ====================== 3. Analysis of stability of relative viral richness estimates over time ===========================
# 1. Order-level comparison of mean viral richness across species
# mean viral richness across species within each order
getOrderVRich = function(year){
resx = curves %>%
dplyr::filter(Year <= year) %>%
dplyr::filter(HostSpecies != "homo sapiens") %>%
dplyr::filter(Domestic == "Wild") %>%
dplyr::group_by(HostSpecies) %>%
dplyr::summarise(VRich = sum(Discovered),
HostOrder = head(HostOrder, 1)) %>%
dplyr::group_by(HostOrder) %>%
dplyr::summarise(VRich_Mean = mean(VRich),
VRich_Median = median(VRich),
VRich_SEM = plotrix::std.error(VRich)) %>%
dplyr::arrange(desc(VRich_Mean)) %>%
dplyr::mutate(Year = year)
return(resx)
}
ord_over_time = do.call(rbind.data.frame, lapply(seq(1960, 2015, by=5), getOrderVRich))
oot = reshape2::dcast(ord_over_time[ , c("HostOrder", "Year", "VRich_Mean")], HostOrder ~ Year, value.var="VRich_Mean")
# calculate spearman rank correlation between 2015 and all other years (examine temporal decay)
cor_rho = function(x){ return( as.vector(cor.test(oot$`2015`, x, method="spearman")$estimate) ) }
stab1 = as.data.frame(apply(oot[ , 2:ncol(oot)], 2, cor_rho)) %>%
rename("rho" = 1) %>%
dplyr::mutate(year = seq(1960, 2015, by=5),
model = "Order")
# 2. Family-level comparison of mean viral richness across species
# mean viral richness across species within each order
getFamilyVRich = function(year){
resx = curves %>%
dplyr::filter(Year <= year) %>%
dplyr::filter(HostSpecies != "homo sapiens") %>%
dplyr::filter(Domestic == "Wild") %>%
dplyr::group_by(HostSpecies) %>%
dplyr::summarise(VRich = sum(Discovered),
HostFamily = head(HostFamily, 1),
HostOrder = head(HostOrder, 1)) %>%
dplyr::group_by(HostFamily) %>%
dplyr::summarise(VRich_Mean = mean(VRich),
VRich_Median = median(VRich),
VRich_SEM = plotrix::std.error(VRich),
HostOrder = head(HostOrder, 1)) %>%
dplyr::arrange(desc(VRich_Mean)) %>%
dplyr::mutate(Year = year)
return(resx)
}
fam_over_time = do.call(rbind.data.frame, lapply(seq(1960, 2015, by=5), getFamilyVRich))
fot = reshape2::dcast(fam_over_time[ , c("HostFamily", "Year", "VRich_Mean")], HostFamily ~ Year, value.var="VRich_Mean")
# calculate spearman rank correlation between 2015 and all other years (examine temporal decay)
cor_rho = function(x){ return( as.vector(cor.test(fot$`2015`, x, method="spearman")$estimate) ) }
stab2 = as.data.frame(apply(fot[ , 2:ncol(fot)], 2, cor_rho)) %>%
rename("rho" = 1) %>%
dplyr::mutate(year = seq(1960, 2015, by=5),
model = "Family")
ggplot(rbind(stab1, stab2)) +
geom_line(aes(year, rho, col=model)) +
geom_point(aes(year, rho, col=model))
# 3. Species-level comparison of ranking of viral richness across years
# diversity estimates in 5 year increments
getSpeciesVRich = function(year){
resx = curves %>%
dplyr::filter(Year <= year) %>%
dplyr::filter(HostSpecies != "homo sapiens") %>%
dplyr::filter(Domestic == "Wild") %>%
dplyr::group_by(HostSpecies) %>%
dplyr::summarise(VRich = sum(Discovered),
HostOrder = head(HostOrder, 1),
Domestic = head(Domestic, 1),
Pubs = sum(NumPubs, na.rm=TRUE),
VRich_2015 = head(VRichness, 1)) %>%
dplyr::mutate(Year = year)
return(resx)
}
rich_over_time = do.call(rbind.data.frame, lapply(seq(1960, 2015, by=5), getSpeciesVRich))
# over time
rot2 = reshape2::dcast(rich_over_time[ , c("HostSpecies", "Year", "VRich")], HostSpecies ~ Year, value.var="VRich") %>%
left_join(rich_over_time[ !duplicated(rich_over_time$HostSpecies), c("HostSpecies", "HostOrder", "VRich_2015") ])
# run for all orders
result = data.frame()
orders = c("Carnivora", "Chiroptera", "Cetartiodactyla", "Lagomorpha", "Perissodactyla", "Primates", "Rodentia", "Diprotodontia", "Didelphimorphia")
for(i in 1:(length(orders)+2)){
if(i == 1){
datx = rot2
orderx = "Species"
} else if(i == 2){
datx = rot2[ rot2$VRich_2015 >= 5, ]
orderx = "Species (>5)"
} else{
orderx = orders[i-2]
datx = rot2[ rot2$HostOrder == orderx, ]
}
# run
cor_rho = function(x){ return( as.vector(cor.test(datx$`2015`, x, method="spearman")$estimate) ) }
resx = as.data.frame(apply(datx[ , 2:(ncol(datx)-2)], 2, cor_rho)) %>%
rename("rho" = 1) %>%
dplyr::mutate(model = orderx)
resx$year = seq(1960, 2015, by=5)
result = rbind(result, resx)
}
# stab3
stab3 = result
stab_agg = do.call(rbind.data.frame, list(stab1, stab2, stab3[ grep("Species", stab3$model), ]))
head(stab_agg)
tail(stab_agg)
stab_orders = stab3[ !grepl("Species", stab3$model), ]
head(stab_orders)
# plots
ggplot(stab_agg) +
geom_line(aes(year, rho, col=model))
# plots
ggplot(stab_agg) +
geom_line(aes(year, rho, col=model)) +
ylim(0, 1)
ggplot(stab_orders) +
geom_line(aes(year, rho, col=model)) +
ylim(0, 1)
# plots
ggplot(stab_agg) +
geom_line(aes(year, rho, col=model)) +
ylim(0, 1)
# plots
ggplot(stab_agg) +
geom_line(aes(year, rho, col=factor(model))) +
ylim(0, 1)
# plots
ggplot(stab_agg) +
geom_line(aes(year, rho, col=model)) +
ylim(0, 1) +
scale_color_viridis_d()
# plots
ggplot(stab_agg) +
geom_line(aes(year, rho, col=model)) +
ylim(0, 1) +
scale_color_viridis_d() +
theme_minimal() +
geom_vline(xintercept=2015, lty=2) +
scale_x_reverse()
# plots
ggplot(stab_agg) +
geom_line(aes(year, rho, col=model)) +
ylim(0, 1) +
scale_color_viridis_d() +
theme_minimal() +
geom_vline(xintercept=2015, lty=2)
# plots
ggplot(stab_agg) +
geom_line(aes(year, rho, col=model)) +
ylim(0, 1) +
scale_color_viridis_d(begin=0.2, end=0.9) +
theme_minimal() +
geom_vline(xintercept=2015, lty=2)
# plots
ggplot(stab_agg) +
geom_line(aes(year, rho, col=model)) +
ylim(0, 1) +
scale_color_viridis_d(begin=0.2, end=0.8) +
theme_minimal() +
geom_vline(xintercept=2015, lty=2)
# plots
ggplot(stab_agg) +
geom_line(aes(year, rho, col=model)) +
ylim(0, 1) +
scale_color_viridis_d(begin=1, end=0.8) +
theme_minimal() +
geom_vline(xintercept=2015, lty=2)
# plots
ggplot(stab_agg) +
geom_line(aes(year, rho, col=model)) +
ylim(0, 1) +
scale_color_viridis_d(begin=0, end=0.8) +
theme_minimal() +
geom_vline(xintercept=2015, lty=2)
# plots
ggplot(stab_agg) +
geom_line(aes(year, rho, col=model), size=1) +
ylim(0, 1) +
scale_color_viridis_d(begin=0, end=0.8) +
theme_minimal() +
geom_vline(xintercept=2015, lty=2)
# plots
ggplot(stab_agg [ stab_agg$model != "Species (>5)", ]) +
geom_line(aes(year, rho, col=model), size=1) +
ylim(0, 1) +
scale_color_viridis_d(begin=0, end=0.8) +
theme_minimal() +
geom_vline(xintercept=2015, lty=2)
# plots
ggplot(stab_agg [ stab_agg$model != "Species (>5)", ]) +
geom_line(aes(year, rho, col=model), size=1) +
ylim(0, 1) +
scale_color_viridis_d(begin=0, end=0.8) +
theme_minimal() +
geom_vline(xintercept=2015, lty=2) +
ylab("Spearman rho (rank correlation)") +
xlab("Year")
ggplot(stab_orders) +
geom_line(aes(year, rho, col=model), size=1) +
ylim(0, 1) +
scale_color_viridis_d(begin=0, end=0.8) +
theme_minimal() +
geom_vline(xintercept=2015, lty=2) +
ylab("Spearman rho (rank correlation)") +
xlab("Year")
# plots
p1 = ggplot(stab_agg [ stab_agg$model != "Species (>5)", ]) +
geom_line(aes(year, rho, col=model), size=1) +
ylim(0, 1) +
scale_color_viridis_d(begin=0, end=0.8) +
theme_minimal() +
geom_vline(xintercept=2015, lty=2) +
ylab("Spearman rho (rank correlation)") +
xlab("Year")
p2 = ggplot(stab_orders) +
geom_line(aes(year, rho, col=model), size=1) +
ylim(0, 1) +
scale_color_viridis_d(begin=0, end=0.8) +
theme_minimal() +
geom_vline(xintercept=2015, lty=2) +
ylab("Spearman rho (rank correlation)") +
xlab("Year")
gridExtra::grid.arrange(p1, p2, nrow=1)
p2 = ggplot(stab_orders) +
geom_line(aes(year, rho, col=model), size=1) +
ylim(0, 1) +
scale_color_viridis_d(begin=0, end=0.8) +
facet_wrap(~model) +
theme_minimal() +
geom_vline(xintercept=2015, lty=2) +
ylab("Spearman rho (rank correlation)") +
xlab("Year")
p2
# plots
p1 = ggplot(stab_agg [ stab_agg$model != "Species (>5)", ]) +
geom_line(aes(year, rho, col=model), size=1) +
ylim(0, 1) +
scale_color_viridis_d(begin=0, end=0.8) +
theme_minimal() +
geom_vline(xintercept=2015, lty=2) +
ylab("Spearman rho (rank correlation)") +
xlab("Year")
p2 = ggplot(stab_orders) +
geom_line(aes(year, rho, col=model), size=1) +
ylim(0, 1) +
scale_color_viridis_d(begin=0, end=0.8) +
facet_wrap(~model) +
theme_minimal() +
theme(legend.position="none") +
geom_vline(xintercept=2015, lty=2) +
ylab("Spearman rho (rank correlation)") +
xlab("Year")
gridExtra::grid.arrange(p1, p2, nrow=1)
# plots
p1 = ggplot(stab_agg [ stab_agg$model != "Species (>5)", ]) +
geom_line(aes(year, rho, col=model), size=1) +
ylim(0, 1) +
scale_color_viridis_d(begin=0, end=0.8) +
theme_minimal() +
geom_vline(xintercept=2015, lty=2) +
ylab("Spearman rho (rank correlation)") +
xlab("Year") +
theme(legend.title = element_blank())
p1
# plots
p1 = ggplot(stab_agg [ stab_agg$model != "Species (>5)", ]) +
geom_line(aes(year, rho, col=model), size=1) +
ylim(0, 1) +
scale_color_viridis_d(begin=0, end=0.8) +
theme_minimal() +
geom_vline(xintercept=2015, lty=2) +
ylab("Spearman rho (rank correlation)") +
xlab("Year") +
theme(legend.title = element_blank(),
legend.position = c(0.9, 0.1))
p1
# plots
p1 = ggplot(stab_agg [ stab_agg$model != "Species (>5)", ]) +
geom_line(aes(year, rho, col=model), size=1) +
ylim(0, 1) +
scale_color_viridis_d(begin=0, end=0.8) +
theme_minimal() +
geom_vline(xintercept=2015, lty=2) +
ylab("Spearman rho (rank correlation)") +
xlab("Year") +
theme(legend.title = element_blank(),
legend.position = c(0.1, 0.9))
p1
# plots
p1 = ggplot(stab_agg [ stab_agg$model != "Species (>5)", ]) +
geom_line(aes(year, rho, col=model), size=1) +
ylim(0, 1) +
scale_color_viridis_d(begin=0, end=0.8) +
theme_minimal() +
geom_vline(xintercept=2015, lty=2) +
ylab("Spearman rho (rank correlation)") +
xlab("Year") +
theme(legend.title = element_blank(),
legend.position = c(0.2, 0.9))
p1
p2 = ggplot(stab_orders) +
geom_line(aes(year, rho, col=model), size=1) +
ylim(0, 1) +
scale_color_viridis_d(begin=0, end=0.8) +
facet_wrap(~model) +
theme_minimal() +
theme(legend.position="none") +
geom_vline(xintercept=2015, lty=2) +
ylab("Spearman rho (rank correlation)") +
xlab("Year")
gridExtra::grid.arrange(p1, p2, nrow=1)
# plots
ss = stab_agg[ stab_agg$model != "Species (>5)", ]
# plots
ss = stab_agg[ stab_agg$model != "Species (>5)", ]
ss$model = factor(ss$model, levels=c("Order", "Family", "Species"), ordered=TRUE)
p1 = ggplot(ss) +
geom_line(aes(year, rho, col=model), size=1) +
ylim(0, 1) +
scale_color_viridis_d(begin=0, end=0.8) +
theme_minimal() +
geom_vline(xintercept=2015, lty=2) +
ylab("Spearman rho (rank correlation)") +
xlab("Year") +
theme(legend.title = element_blank(),
legend.position = c(0.2, 0.9))
p2 = ggplot(stab_orders) +
geom_line(aes(year, rho, col=model), size=1) +
ylim(0, 1) +
scale_color_viridis_d(begin=0, end=0.8) +
facet_wrap(~model) +
theme_minimal() +
theme(legend.position="none") +
geom_vline(xintercept=2015, lty=2) +
ylab("Spearman rho (rank correlation)") +
xlab("Year")
gridExtra::grid.arrange(p1, p2, nrow=1)
p1 = ggplot(ss) +
geom_line(aes(year, rho, col=model), size=1) +
ylim(0, 1) +
scale_color_viridis_d(begin=0, end=0.8) +
theme_minimal() +
geom_vline(xintercept=2015, lty=2) +
ylab("Spearman rho (rank correlation)") +
xlab("Year") +
theme(legend.title = element_blank(),
axis.title.y = element_blank(),
legend.position = c(0.2, 0.9))
p1
p1 = ggplot(ss) +
geom_line(aes(year, rho, col=model), size=1) +
ylim(0, 1) +
scale_color_viridis_d(begin=0, end=0.8) +
theme_minimal() +
geom_vline(xintercept=2015, lty=2) +
ylab("Spearman rho (rank correlation)") +
xlab("Year") +
theme(legend.title = element_blank(),
legend.position = c(0.2, 0.9))
p2 = ggplot(stab_orders) +
geom_line(aes(year, rho, col=model), size=1) +
ylim(0, 1) +
scale_color_viridis_d(begin=0, end=0.8) +
facet_wrap(~model) +
theme_minimal() +
theme(legend.position="none",
axis.title.y = element_blank()) +
geom_vline(xintercept=2015, lty=2) +
ylab("Spearman rho (rank correlation)") +
xlab("Year")
gridExtra::grid.arrange(p1, p2, nrow=1)
p1 = ggplot(ss) +
geom_line(aes(year, rho, col=model), size=1) +
ylim(0, 1) +
scale_color_viridis_d(begin=0, end=0.8) +
theme_minimal() +
geom_vline(xintercept=2015, lty=2) +
ylab("Spearman rho (rank correlation)") +
xlab("Year") +
theme(legend.title = element_blank(),
axis.title = element_text(size=12),
legend.text = element_text(size=12),
legend.position = c(0.2, 0.9))
p2 = ggplot(stab_orders) +
geom_line(aes(year, rho, col=model), size=1) +
ylim(0, 1) +
scale_color_viridis_d(begin=0, end=0.8) +
facet_wrap(~model) +
theme_minimal() +
theme(legend.position="none",
strip.text = element_text(size=12),
axis.title.y = element_blank()) +
geom_vline(xintercept=2015, lty=2) +
ylab("Spearman rho (rank correlation)") +
xlab("Year")
gridExtra::grid.arrange(p1, p2, nrow=1)
p1 = ggplot(ss) +
geom_line(aes(year, rho, col=model), size=1) +
ylim(0, 1) +
scale_color_viridis_d(begin=0, end=0.8) +
theme_minimal() +
geom_vline(xintercept=2015, lty=2) +
ylab("Spearman rho (rank correlation)") +
xlab("Year") +
theme(legend.title = element_blank(),
axis.title = element_text(size=13),
axis.text = element_text(size=11),
legend.text = element_text(size=12),
legend.position = c(0.2, 0.9))
p2 = ggplot(stab_orders) +
geom_line(aes(year, rho, col=model), size=1) +
ylim(0, 1) +
scale_color_viridis_d(begin=0, end=0.8) +
facet_wrap(~model) +
theme_minimal() +
theme(legend.position="none",
strip.text = element_text(size=12),
axis.title.x = element_text(size=13),
axis.text = element_text(size=11),
axis.title.y = element_blank()) +
geom_vline(xintercept=2015, lty=2) +
ylab("Spearman rho (rank correlation)") +
xlab("Year")
gridExtra::grid.arrange(p1, p2, nrow=1)
head(rot2[ rot2$HostOrder == "Perissodactyla", ])
rot2[ rot2$HostOrder == "Perissodactyla", ]
p_comb = gridExtra::grid.arrange(p1, p2, nrow=1)
ggsave(p_comb, file="./output/figures/TemporalDecayFigure.png", device="png", dpi=600, units="in", width=10, height=5)
ss = stab_agg[ stab_agg$model != "Species (>5)", ]
ss$model = factor(ss$model, levels=c("Order", "Family", "Species"), ordered=TRUE)
p1 = ggplot(ss) +
geom_line(aes(year, rho, col=model), size=1) +
ylim(0, 1) +
scale_color_viridis_d(begin=0, end=0.8) +
theme_minimal() +
geom_vline(xintercept=2015, lty=2) +
ylab("Spearman rho (rank correlation)") +
xlab("Year") +
theme(legend.title = element_blank(),
axis.title = element_text(size=13),
axis.text = element_text(size=11),
panel.grid.minor = element_blank(),
legend.text = element_text(size=12),
legend.position = c(0.2, 0.9))
p2 = ggplot(stab_orders) +
geom_line(aes(year, rho, col=model), size=1) +
ylim(0, 1) +
scale_color_viridis_d(begin=0, end=0.8) +
facet_wrap(~model) +
theme_minimal() +
theme(legend.position="none",
strip.text = element_text(size=12),
axis.title.x = element_text(size=13),
panel.grid.minor = element_blank(),
axis.text = element_text(size=11),
axis.title.y = element_blank()) +
geom_vline(xintercept=2015, lty=2) +
ylab("Spearman rho (rank correlation)") +
xlab("Year")
p_comb = gridExtra::grid.arrange(p1, p2, nrow=1)
ggsave(p_comb, file="./output/figures/TemporalDecayFigure.png", device="png", dpi=600, units="in", width=10, height=5)
ggsave(p_comb, file="./output/figures/TemporalDecayFigure.png", device="png", dpi=600, units="in", width=12, height=6)
